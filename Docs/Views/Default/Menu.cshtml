@model bool

@using (var db = new SiteContext())
{
	var allMenu = db.DocsMenu
		.ToList();

	var allPages = db.DocsPages
		.ToList();

	foreach (var menu in allMenu)
	{
		menu.Pages = allPages
			.Where(x => x.MenuId == menu.Id)
			.ToList();
	}

	var firstRankMenu = allMenu
		.Where(x => x.MenuId == 0)
		.ToList();

	foreach (var menu in firstRankMenu)
	{
		menu.LoadSubMenuFromAllList(allMenu);
	}

	<div class="nav">
		@foreach (var menu in firstRankMenu)
		{
			@RenderMenu(menu)
		}
		@if (Model)
		{
			<a href="~/default/tree" style="color: #0173fe; width: 2em;">
				<i icon>settings</i>
			</a>
		}
		<a href="~/default/search" title="Нажмите для перехода к поиску по документам" style="color: #0173fe; width: 2em;">
			<i icon>search</i>
		</a>
	</div>
}

<style>
	.nav {
		background: #fff;
		display: table;
		width: 100%;
		font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		font-size: 13px;
		position: relative;
	}

		.nav a {
			padding: .1em 1em;
			color: #222;
			text-decoration: none;
			cursor: pointer;
		}
			.nav a:hover {
				background: #ddd;
			}

		.nav > * {
			display: table-cell;
		}

		.nav > a {
			text-align: center;
		}

	.nav_block {
		/*position: relative;*/
	}

		.nav_block a {
			display: block;
		}

		.nav_block > a {
			font-weight: 500;
			font-size: 1.1em;
			text-align: center;
			border: 1px solid transparent;
		}

		.nav_block > div {
			display: none;
			position: absolute;
			/*width: 99.7%;*/
			background: #fff;
			border: 1px solid #ccc;
			border-top: 0;
			z-index: 1;
		}

		.nav_block .nav_block {
			padding-left: 2em;
		}

		.nav_block .nav_block > div {
			display: block;
		}

		.nav_block.open > a {
			background: #ddd;
		}

		.nav_block.open > div {
			display: block;
		}

		.nav_sub {
			padding: 4px 0;
		}

			.nav_sub > a {
				font-weight: 500;
			}

			.nav_sub > a:hover {
				background: inherit;
			}

			.nav_sub > div > a {
				padding-left: 2em;
			}

			.nav_sub .nav_sub > div > a {
				padding-left: 3em;
			}

			.nav_sub .nav_sub .nav_sub > div > a {
				padding-left: 4em;
			}

			.nav_sub .nav_sub .nav_sub .nav_sub > div > a {
				padding-left: 5em;
			}
</style>
<script>
	var blocks = document.querySelectorAll('.nav_block')
	for (var i = 0; i < blocks.length; i++) {
		blocks[i].onmouseenter = function () {
			this.classList.add('open')
		}
		blocks[i].onmouseleave = function () {
			this.classList.remove('open')
		}
	}
</script>

@helper RenderMenu(DocsMenu menu)
{
	<div class="nav_block">
		<a>@menu.Name</a>
		<div>
			@foreach (var sub in menu.SubMenuList)
			{
				@RenderSubMenu(sub)
			}
			@foreach (var page in menu.Pages)
			{
				<a href="~/page/@page.Id">@page.Name</a>
			}
		</div>
	</div>
}

@helper RenderSubMenu(DocsMenu menu)
{
	<div class="nav_sub">
		<a>@menu.Name</a>
		<div>
			@foreach (var sub in menu.SubMenuList)
			{
				@RenderSubMenu(sub)
			}
			@foreach (var page in menu.Pages)
			{
				<a href="@Url.Action("", "Pages", new { Id = page.Id })">@page.Name</a>
			}
		</div>
	</div>
}
